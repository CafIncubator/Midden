<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Midden: Research Data Catalog</title>
    <base href="/" />
    <!-- <link href="css/bootstrap/bootstrap.min.css" rel="stylesheet" />-->
    <link href="css/app.css" rel="stylesheet" />
    <link href="Caf.Midden.Wasm.styles.css" rel="stylesheet" />
    <link href="manifest.json" rel="manifest" />
    <link rel="apple-touch-icon" sizes="512x512" href="apple-icon.png" />

    <link href="_content/AntDesign/css/ant-design-blazor.css" rel="stylesheet" />
    <script src="_content/AntDesign/js/ant-design-blazor.js"></script>

    <link href="_content/PSC.Blazor.Components.MarkdownEditor/css/easymde.min.css" rel="stylesheet" />

    <link href="_content/Z.Blazor.Diagrams/style.min.css" rel="stylesheet" />
    <!-- If you want the default style -->
    <link href="_content/Z.Blazor.Diagrams/default.styles.min.css" rel="stylesheet" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
          integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
          crossorigin="" />
    <link href="css/custom.css" rel="stylesheet" />

</head>

<body>
    <div id="app">
        <div style="position:absolute; top:30vh; width:100%; text-align:center">
            <h1>Midden: Research Data Catalog</h1>
            <p><i class="oi oi-loop-circular icn-spinner"></i> Loading...</p>
        </div>
    </div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">🗙</a>
    </div>

    <script src="_framework/blazor.webassembly.js"></script>

    <script>navigator.serviceWorker.register('service-worker.js');</script>

    <script type="text/javascript">
        function saveAsFile(filename, bytesBase64) {
            if (navigator.msSaveBlob) {
                //Download document in Edge browser
                var data = window.atob(bytesBase64);
                var bytes = new Uint8Array(data.length);
                for (var i = 0; i < data.length; i++) {
                    bytes[i] = data.charCodeAt(i);
                }
                var blob = new Blob([bytes.buffer], { type: "application/octet-stream" });
                navigator.msSaveBlob(blob, filename);
            }
            else {
                var link = document.createElement('a');
                link.download = filename;
                link.href = "data:application/octet-stream;base64," + bytesBase64;
                document.body.appendChild(link); // Needed for Firefox
                link.click();
                document.body.removeChild(link);
            }
        }

        window.downloadCSV = (filename, content) => {
            console.log("JavaScript function downloadCSV called!");

            if (!content) {
                console.error("No content provided for CSV download.");
                return;
            }

            console.log("Content preview:", content.substring(0, 200) + "...");

            try {
                // Encode content as UTF-8 with BOM to fix character encoding issues
                const BOM = "\uFEFF"; // Byte Order Mark (UTF-8)
                const blob = new Blob([BOM + content], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);

                // Create a hidden <a> element for download
                const link = document.createElement("a");
                link.setAttribute("href", url);
                link.setAttribute("download", filename);
                link.style.visibility = "hidden";

                console.log("Appending download link to document...");
                document.body.appendChild(link);

                // Trigger the download
                console.log("Triggering download...");
                link.click();

                // Cleanup
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                console.log("Download should now be triggered!");
            } catch (error) {
                console.error("Error during CSV download:", error);
            }
        };




    </script>
    <script src="https://unpkg.com/@antv/g2plot@1.1.28/dist/g2plot.js"></script>
    <script src="_content/AntDesign.Charts/ant-design-charts-blazor.js"></script>

    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
            integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
            crossorigin=""></script>

    <!-- Markdown editor stuff -->
    <script src="_content/PSC.Blazor.Components.MarkdownEditor/js/easymde.min.js"></script>
    <script src="_content/PSC.Blazor.Components.MarkdownEditor/js/markdownEditor.js"></script>

    <!-- For Z.Blazor.Diagrams -->
    <script src="_content/Z.Blazor.Diagrams/script.min.js"></script>

</body>

</html>
